<html>
  <head>
    <title>Dependency Graph</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://unpkg.com/cytoscape@3.1.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/cytoscape-cose-bilkent@4.0.0/cytoscape-cose-bilkent.js"></script>
    <style>
      body {
        font-family: helvetica;
        font-size: 14px;
      }
      #graph { /*change your css*/
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        z-index: 999;
      }
      h1 {
        opacity: 0.5;
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <div id="graph" style="height: 100%;"></div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var cy = window.cy = cytoscape({
          container: document.getElementById('graph'),
          elements: JSON.parse(<%= @json_graph =%>),

          layout: {
            name: "cose-bilkent",
            animate: false,
            randomize: false,
            fit: true,
            quality: 'default',
            padding: 10,
            nodeRepulsion: 500,
            idealEdgeLength: 50,
            nestingFactor: 0.1,
            animate: false,
          },

          // so we can see the ids
          style: [
            {
              selector: 'node[weight > 90]', // Node group
              style: {
                'label': 'data(id)',
                'font-size': '20px',
                'text-margin-y': '-30px',
              }
            },
            {
              selector: 'node', // Dependency node
              style: {
                'label': 'data(label)',
                'font-size': '18px',
              }
            },
            {
              selector: 'edge',
              style: {
                'label': 'data(label)',
                'color': '#999',
                'font-size': '12px',
                'width': '2px',
                'line-color': '#ddd'
              }
            },
            ]
        });
      });
    </script>
  </body>
</html>
